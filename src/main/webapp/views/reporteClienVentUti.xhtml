<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="./../templates/main.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="content">
        <div>
            <h3>#{beanReporteClienteVenta.title}</h3>
        </div>
        <p:ajaxStatus onsuccess="PF('statusDialog').hide()" />
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false"
                  closable="false" resizable="false" showHeader="false">
            <p:graphicImage value="../resources/img/carga.gif" />
        </p:dialog>
        <h:form id="formContent">
            <p:messages id="messages" showDetail="true" showSummary="false" autoUpdate="true" closable="true" />
            <p:panel>
                <div class="container-fluid">

                    <div class="form-group" align="right">
                        <p:commandButton value="Buscar" resetValues="true" update=":formContent" action="#{beanReporteClienteVenta.searchById()}"  onclick="PF('statusDialog').show()"/>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 form-group">
                        <p:outputLabel class="col-lg-4 col-md-4 col-sm-4 col-xs-12 "  for="autocompleteCliente" value ="Cliente:" /> 
                        <p:autoComplete  placeholder="Seleccione un Cliente" id="autocompleteCliente" requiredMessage="Ingresa un valor para el campo Cliente." styleClass="autocomplete-input-text-media ui-state-highlight-autocomplete" class="ui-state-highlight-autocomplete"
                                         value="#{beanReporteClienteVenta.data}" completeMethod="#{beanReporteClienteVenta.autoCompleteCliente}" forceSelection="true" var="cliente"  inputStyle="width: 180px"
                                         itemLabel="#{cliente.nombreCompleto.trim()}"
                                         itemValue="#{cliente.idClientePk}" converter="#{clienteConverter}">
                            <p:ajax event="itemSelect"/>
                            <p:ajax event="change"/>
                        </p:autoComplete>
                        <pe:keyFilter for="autocompleteCliente" regEx="/[a-z0-9-_Ã±\s]/i" />
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 form-group">
                        <p:outputLabel value="Dias de Recuperación: #{beanReporteClienteVenta.diasRecuperacion}" rendered="#{beanReporteClienteVenta.viewEstate =='searchById'}"/>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 form-group">
                        <p:outputLabel value="Recuperación Ultimos 3 Créditos: #{beanReporteClienteVenta.diasRecuperacionTres}" rendered="#{beanReporteClienteVenta.viewEstate =='searchById'}"/>
                    </div>
                    <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <!--<p:chart style="height:500px;" type="line" responsive="true" rendered ="{beanReporteClienteVenta.chartLine != null}" model="{beanReporteClienteVenta.chartLine}"/>-->
                        <p:chart style="height:350px;" type="bar"  responsive="true" rendered ="#{beanReporteClienteVenta.chartBar != null}" model="#{beanReporteClienteVenta.chartBar}" />
                    </div>


                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 form-group">
                            <p:dataTable var="model" value="#{beanReporteClienteVenta.lstCreditoActivos}" styleClass="ui-datatable-hor-scroll" scrollable="true" 
                                         scrollHeight="200" rows="50" rendered="#{beanReporteClienteVenta.viewEstate =='searchById'}">
                                <f:facet name="header">
                                    Créditos Activos
                                </f:facet>
                                <p:column headerText="Fecha de Compra">
                                    <h:outputText value="#{model.fechaInicioCredito}">
                                        <f:convertDateTime parent="dd/mm/yyyy HH:mm"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Monto" class="alignRight">
                                    <h:outputText value="#{model.montoCredito}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Dias" class="alignRight">
                                    <h:outputText value="#{model.diasCredito}"/>
                                </p:column>
                                <p:columnGroup type="footer">
                                    <p:column colspan="1" footerText="Total:" class="alignRight"/>
                                    <p:column colspan="1"/>
                                    <p:column colspan="1" class="alignRight">
                                        <f:facet name="footer">
                                            <h:outputText value="#{beanReporteClienteVenta.diasPromedioActivo}"/>
                                        </f:facet>
                                    </p:column>
                                </p:columnGroup>
                            </p:dataTable>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 form-group">
                            <p:dataTable var="model" value="#{beanReporteClienteVenta.lstCredito}" rendered="#{beanReporteClienteVenta.viewEstate =='searchById'}">

                                <f:facet name="header">
                                    Créditos Finalizados
                                </f:facet>
                                <p:column headerText="Fecha de Compra">
                                    <h:outputText value="#{model.fechaInicioCredito}">
                                        <f:convertDateTime parent="dd/mm/yyyy HH:mm"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Monto" class="alignRight">
                                    <h:outputText value="#{model.montoCredito}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Dias" class="alignRight">
                                    <h:outputText value="#{model.diasCredito}"/>
                                </p:column>
                                <p:columnGroup type="footer">
                                    <p:column colspan="1" footerText="Total:" class="alignRight"/>
                                    <p:column colspan="1"/>
                                    <p:column colspan="1" class="alignRight">
                                        <f:facet name="footer">
                                            <h:outputText value="#{beanReporteClienteVenta.diasPromedioInactivo}"/>
                                        </f:facet>
                                    </p:column>
                                </p:columnGroup>
                            </p:dataTable>
                        </div>
                        <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12 col-lg-offset-1 col-md-offset-1 form-group">
                            <p:dataTable var="model" value="#{beanReporteClienteVenta.model}"  styleClass="ui-datatable-hor-scroll" scrollable="true" 
                                         scrollHeight="500" rendered="#{beanReporteClienteVenta.viewEstate =='init'}" rowIndexVar="rowIndex"
                                         rowStyleClass="#{model.diasRecuperacion.intValue() eq 0 ? 'alert-warning': (model.diasRecuperacion.intValue() le 15 ? 'alert-success':(model.diasRecuperacion.intValue() le 30 ? 'alert-info':'alert-danger'))}">>
                                <p:column headerText="Num" width="38">
                                    <h:outputText value="#{rowIndex+1}"/>
                                </p:column>
                                <p:column headerText="Nombre" width="180" sortBy="#{model.nombreCliente}">
                                    <h:outputText value="#{model.nombreCliente}"/>
                                </p:column>
                                <p:column headerText="Promedio Recuperacíon" sortBy="#{model.diasRecuperacion}" width="120" class="alignRight">
                                    <h:outputText value="#{model.diasRecuperacion}">
                                        <f:convertNumber pattern="#,###.##" />
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total Compras" sortBy="#{model.totalMayoreoContado.add(model.totalMayoreoCredito.add(model.totalMenudeoContado.add(model.totalMenudeoCredito)))}" class="alignRight" width="120">
                                    <h:outputText value="#{model.totalMayoreoContado.add(model.totalMayoreoCredito.add(model.totalMenudeoContado.add(model.totalMenudeoCredito)))}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total Utilidad" sortBy="#{model.utilidadMayoreoComision.add(model.utilidadMayoreoCosto.add(model.utilidadMayoreoPacto.add(model.utilidadMenudeo)))}" class="alignRight" width="120">
                                    <h:outputText value="#{model.utilidadMayoreoComision.add(model.utilidadMayoreoCosto.add(model.utilidadMayoreoPacto.add(model.utilidadMenudeo)))}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Porcentaje Utilidad" sortBy="#{model.porcentajeUtilidad}" class="alignRight" width="120">
                                    <h:outputText value="#{model.porcentajeUtilidad}">
                                        <f:convertNumber type="percent"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
